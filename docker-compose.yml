version: '3.8'

services:
  # Database
  db:
    image: mysql:8.0
    container_name: resortwala_db
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: resortwala
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - resortwala-net

  # API (Laravel + PHP-FPM)
  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: resortwala_api
    restart: unless-stopped
    working_dir: /var/www/html
    environment:
      DB_CONNECTION: mysql
      DB_HOST: 77.37.47.243
      DB_PORT: 3306
      DB_DATABASE: resortwala_staging
      DB_USERNAME: resortwala_staging
      DB_PASSWORD: StagingPass2026
      ASSET_URL: https://resortwala.com
    volumes:
      - ./api:/var/www/html
    networks:
      - resortwala-net
    depends_on:
      - db

  # API Web Server (Nginx)
  api_web:
    image: nginx:alpine
    container_name: resortwala_api_web
    restart: unless-stopped
    ports:
      - "8000:80"
    volumes:
      - ./api:/var/www/html
      - ./docker/nginx/api.conf:/etc/nginx/conf.d/default.conf
    networks:
      - resortwala-net
    depends_on:
      - api

  # Customer Frontend
  customer:
    build:
      context: ./client-customer
      dockerfile: Dockerfile
    container_name: resortwala_customer
    restart: unless-stopped
    ports:
      - "3005:80"
    networks:
      - resortwala-net
    environment:
      - VITE_API_BASE_URL=http://localhost:8000
    depends_on:
      - api_web

  # Admin Frontend
  admin:
    build:
      context: ./client-admin
      dockerfile: Dockerfile
    container_name: resortwala_admin
    restart: unless-stopped
    ports:
      - "3001:80"
    networks:
      - resortwala-net
    environment:
      - VITE_API_BASE_URL=http://localhost:8000
    depends_on:
      - api_web

  # Vendor Frontend
  vendor:
    build:
      context: ./client-vendor
      dockerfile: Dockerfile
    container_name: resortwala_vendor
    restart: unless-stopped
    ports:
      - "3002:80"
    networks:
      - resortwala-net
    environment:
      - VITE_API_BASE_URL=http://localhost:8000
    depends_on:
      - api_web

  # Database Management (Adminer)
  adminer:
    image: adminer
    container_name: resortwala_adminer
    restart: always
    ports:
      - "8080:8080"
    networks:
      - resortwala-net
    depends_on:
      - db

networks:
  resortwala-net:
    driver: bridge

volumes:
  db_data:
